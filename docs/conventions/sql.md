# SQL 开发规范（通用）

适用于包含 SQL 迁移/脚本管理的项目。

## 命名规范

```
YYYYMMDD_HHMMSS_描述.sql
```

## 强制规则

1. **禁止删除或修改已提交脚本**：迁移系统通常只识别文件名，修改内容不会被重新执行，易导致环境不一致。
2. **修复用新脚本**：错误修复通过新增脚本完成（DROP/ADD/MODIFY/RENAME）。
3. **禁止跨脚本 AFTER 依赖**：`AFTER column_name` 只能引用同一脚本内新增的字段。
4. **有依赖就合并**：同一功能或相互依赖字段放在同一脚本。
5. **脚本尽量单一目的**：一个脚本聚焦一个功能变更，便于回溯与审计。
6. **禁止使用外键**：避免跨表强耦合与线上锁风险，完整性由应用层保障。
7. **不建议使用视图**：默认不使用，若必须使用需说明场景与性能评估，并在方案/开发记录中注明。

## 顺序与依赖

- 迁移脚本按文件名排序执行，时间戳保证执行顺序。
- 若项目区分“schema 脚本”和“增量迁移”，禁止 schema 脚本依赖增量脚本创建的表。
- 多人并行时避免同秒冲突，可延后一秒或追加后缀（如 `_a/_b`）。

## 提交前检查

- 确认脚本命名与排序符合预期。
- 确认无跨脚本 AFTER 依赖。

## 变更策略（建议）

- 结构变更与数据回填分步执行：先加字段（允许 NULL）→ 回填数据 → 再加约束（NOT NULL/UNIQUE）。
- 若脚本尚未推送远端，可在本地调整或重建；一旦推送远端，必须追加修复脚本。
