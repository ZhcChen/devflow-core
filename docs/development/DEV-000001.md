# DEV-000001 通知类 skill（devflow-notifier）

## 1. 目标与范围

- 落地 devflow-notifier 通知能力
- 支持本地绑定配置（.env）与会话开始提示绑定
- 通过脚本发送 Telegram 通知

## 2. 关联文档

- PRD：[docs/requirements/PRD-000001.md](../requirements/PRD-000001.md)
- SPEC：[docs/specs/SPEC-000001.md](../specs/SPEC-000001.md)

## 3. 实现映射（验收矩阵 → 实现）

| 验收项/用例 | 模块/接口 | 说明 |
|------------|----------|------|
| 绑定提示 | scripts/notify_tg.sh | 缺少 .env 时提示绑定并退出 |
| 消息推送 | scripts/notify_tg.sh | 调用 TG Bot API sendMessage |
| 参数校验 | scripts/notify_tg.sh | 校验 .env 与必填变量 |
| Dry-run | scripts/notify_tg.sh | --dry-run 仅输出不发送 |

## 4. 实现清单

- 新增 `skills/devflow-notifier/` 与 SKILL 说明
- 新增通知脚本 `scripts/notify_tg.sh`
- 新增绑定脚本 `scripts/setup_tg_env.sh`
- 更新 `README.md` 与 `.gitignore`

## 5. 关键实现说明

- `.env` 缺失时直接提示绑定并退出，避免误发送
- 绑定脚本写入 `.env` 并设置权限 `600`
- 通知脚本支持标题/正文/项目/事件组合，并提供 `--dry-run`
- API 返回 `ok=true` 判定成功，否则输出错误并返回非 0

## 6. 变更列表

- 新增：
  - `skills/devflow-notifier/SKILL.md`
  - `skills/devflow-notifier/scripts/notify_tg.sh`
  - `skills/devflow-notifier/scripts/setup_tg_env.sh`
- 修改：
  - `.gitignore`
  - `README.md`
  - `docs/requirements/PRD-000001.md`
  - `docs/specs/SPEC-000001.md`
- 删除：无

## 7. 自测清单（对应验收矩阵）

| 用例ID | 验收项 | 结果 | 备注 |
|--------|--------|------|------|
| TC-000001-001 | 绑定提示 | 通过 | 未配置 .env 时退出码=2 |
| TC-000001-002 | 消息推送 | 通过 | 真实 token/chat_id 已验证 |
| TC-000001-003 | 参数校验 | 通过 | 缺失 TG_CHAT_ID 时退出码=2 |
| TC-000001-004 | Dry-run | 通过 | dummy env + dry-run 输出正常 |

用例ID规则见 [conventions/](../conventions/)

## 8. 影响评估（可选）

- 数据库：无
- 配置：新增本地 `.env`
- 兼容性：无
- 依赖：需要 bash + curl

说明：
- 若无影响，填“无”

## 9. 风险与回滚（可选）

- 回滚方式：删除 `skills/devflow-notifier/` 及相关说明文件

## 10. 待办与后续

- 无
